<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Aktueller Tibber Strompreis</title>
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
    }
    .card {
      max-width: 400px;
      margin: 5rem auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card shadow">
      <div class="card-body text-center">
        <h5 class="card-title">Aktueller Strompreis</h5>
        <p id="price" class="display-4">Lade…</p>
        <button id="refreshBtn" class="btn btn-primary">Erneut laden</button>
      </div>
    </div>
  </div>

  <!-- Bootstrap 5 JS Bundle (inkl. Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const API_TOKEN = '0E5C3BEC6B99B1E56C02F0032664299F24BA0AA4703BB20DCAEA287E5A64F907-1';
    const GRAPHQL_ENDPOINT = 'https://api.tibber.com/v1-beta/gql';

    async function fetchCurrentPrice() {
      document.getElementById('price').textContent = 'Lade…';
      try {
        const response = await fetch(GRAPHQL_ENDPOINT, {
          method: 'POST',
          headers: {
            'Authorization': 'Bearer ' + API_TOKEN,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            query: `
              query {
                viewer {
                  homes {
                    currentSubscription {
                      priceInfo {
                        current {
                          total
                          currency
                        }
                      }
                    }
                  }
                }
              }
            `
          })
        });

        if (!response.ok) {
          throw new Error('Netzwerk-Antwort nicht OK: ' + response.status);
        }

        const { data } = await response.json();
        const home = data.viewer.homes[0];
        const priceInfo = home.currentSubscription.priceInfo.current;
        const price = priceInfo.total.toFixed(2);
        const currency = priceInfo.currency;

        document.getElementById('price').textContent = `${price} ${currency}`;
      } catch (err) {
        console.error(err);
        document.getElementById('price').textContent = 'Fehler beim Laden';
      }
    }

    document.getElementById('refreshBtn').addEventListener('click', fetchCurrentPrice);

    // Initialer Ladeaufruf
    fetchCurrentPrice();
  </script>
</body>
</html>
