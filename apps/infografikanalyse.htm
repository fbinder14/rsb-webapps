<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infografiken analysieren - Matching Übung</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Sortable.js -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        /* Hintergrundfarbe nach erfolgreichem Abschluss */
        body.completed {
            background-color: #d4edda !important;
        }

        /* Großes Checkmark nach Abschluss */
        .checkmark-large {
            font-size: 100px;
            color: green;
            display: none;
            text-align: center;
            margin-top: 20px;
        }

        /* Kleines Checkmark neben korrekten Paaren */
        .checkmark-small {
            color: green;
            margin-left: 10px;
            display: none;
        }

        /* Stil für draggable Items */
        .draggable-item {
            cursor: grab;
            user-select: none;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #ffffff;
            border: 1px solid #6c757d;
            border-radius: 5px;
            text-align: center;
        }

        /* Dropzone Styling */
        .dropzone {
            min-height: 50px;
            border: 2px dashed #6c757d;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 15px;
            position: relative;
            background-color: #f8f9fa;
        }

        /* Hover-Effekt für Dropzones */
        .dropzone.hovered {
            border-color: #0d6efd;
            background-color: #e7f1ff;
        }

        /* Stil für gefüllte Dropzones */
        .dropzone.filled {
            border-color: #28a745;
            background-color: #d4edda;
        }

        /* Deaktivierte Elemente */
        .disable-selection {
            pointer-events: none;
            opacity: 0.6;
        }

        /* Ergebnisbereich zunächst versteckt */
        #result {
            display: none;
        }

        /* Label innerhalb der Dropzones */
        .dropzone-label {
            font-weight: bold;
            margin-bottom: 5px;
            display: block;
        }

        /* Inhalt innerhalb der Dropzones */
        .dropzone-content {
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            flex-wrap: wrap;
        }

        /* Platzhaltertext für leere Dropzones */
        .dropzone-content.empty::before {
            content: attr(data-placeholder);
            color: #6c757d;
        }

        .dropzone-content.filled::before {
            content: "";
        }

        /* Shake-Animation */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        .shake {
            animation: shake 0.3s;
        }

        /* Responsive Anpassungen */
        @media (max-width: 576px) {
            .draggable-item {
                font-size: 14px;
            }
            .dropzone-label {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <h1 class="text-center mb-4">Infografiken analysieren - Matching Übung</h1>
        <div id="content" class="row">
            <!-- Draggable Items -->
            <div class="col-md-6 mb-4">
                <h3>Begriffe</h3>
                <div id="draggableList" class="d-flex flex-wrap justify-content-start">
                    <div class="draggable-item" draggable="true" data-key="quelle">Eurostat</div>
                    <div class="draggable-item" draggable="true" data-key="herausgeber">Globus</div>
                    <div class="draggable-item" draggable="true" data-key="bezogen">EU</div>
                    <div class="draggable-item" draggable="true" data-key="zeitraum">2022</div>
                    <div class="draggable-item" draggable="true" data-key="einheit">kg</div>
                    <div class="draggable-item" draggable="true" data-key="diagramm">Kreis-/Balkendiagramm</div>
                </div>
            </div>
            <!-- Dropzones -->
            <div class="col-md-6">
                <h3>Zuordnungen</h3>
                <div id="dropzoneList">
                    <div class="dropzone" data-key="quelle">
                        <span class="dropzone-label">Quelle:</span>
                        <div class="dropzone-content empty" data-placeholder="Ziehe hier ein Element"></div>
                    </div>
                    <div class="dropzone" data-key="herausgeber">
                        <span class="dropzone-label">Herausgeber:</span>
                        <div class="dropzone-content empty" data-placeholder="Ziehe hier ein Element"></div>
                    </div>
                    <div class="dropzone" data-key="bezogen">
                        <span class="dropzone-label">Bezogen auf (Gebiet):</span>
                        <div class="dropzone-content empty" data-placeholder="Ziehe hier ein Element"></div>
                    </div>
                    <div class="dropzone" data-key="zeitraum">
                        <span class="dropzone-label">Zeitraum:</span>
                        <div class="dropzone-content empty" data-placeholder="Ziehe hier ein Element"></div>
                    </div>
                    <div class="dropzone" data-key="einheit">
                        <span class="dropzone-label">Einheit:</span>
                        <div class="dropzone-content empty" data-placeholder="Ziehe hier ein Element"></div>
                    </div>
                    <div class="dropzone" data-key="diagramm">
                        <span class="dropzone-label">Diagrammarten:</span>
                        <div class="dropzone-content empty" data-placeholder="Ziehe hier ein Element"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Ergebnisanzeige -->
        <div id="result" class="text-center mt-4">
            <div class="checkmark-large">✔️</div>
            <p id="timeTaken"></p>
            <h3>Richtige Zuordnungen:</h3>
            <ul id="correctPairs" class="list-group">
                <li class="list-group-item">Quelle: Eurostat</li>
                <li class="list-group-item">Herausgeber: Globus</li>
                <li class="list-group-item">Bezogen auf (Gebiet): EU</li>
                <li class="list-group-item">Zeitraum: 2022</li>
                <li class="list-group-item">Einheit: kg</li>
                <li class="list-group-item">Diagrammarten: Kreis-/Balkendiagramm</li>
            </ul>
            <button id="resetButton" class="btn btn-primary mt-3">Übung zurücksetzen</button>
        </div>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const draggableList = document.getElementById('draggableList');
            let draggableItems = Array.from(document.querySelectorAll('.draggable-item'));
            const dropzones = document.querySelectorAll('.dropzone');
            const resultDiv = document.getElementById('result');
            const checkmarkLarge = document.querySelector('.checkmark-large');
            const timeTaken = document.getElementById('timeTaken');
            const correctPairs = document.getElementById('correctPairs');
            const resetButton = document.getElementById('resetButton');

            let startTime;
            let isCompleted = localStorage.getItem('matchingCompleted') === 'true';

            if (isCompleted) {
                disableExercise();
            } else {
                startTime = new Date().getTime();
                shuffleDraggableItems();
            }

            // Funktion zum zufälligen Anordnen der Draggable Items
            function shuffleDraggableItems() {
                // Fisher-Yates Shuffle Algorithmus
                for (let i = draggableItems.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [draggableItems[i], draggableItems[j]] = [draggableItems[j], draggableItems[i]];
                }
                // Entfernen aller bestehenden Kinder und Hinzufügen der neu sortierten Items
                draggableList.innerHTML = '';
                draggableItems.forEach(item => draggableList.appendChild(item));
            }

            // Initialisieren von Sortable.js für draggable Items
            new Sortable(draggableList, {
                group: {
                    name: 'shared',
                    pull: 'clone',
                    put: false
                },
                sort: false,
                animation: 150,
                ghostClass: 'ghost',
                onEnd: function (evt) {
                    // Nach dem Drag-End-Event können zusätzliche Logiken hier eingefügt werden
                }
            });

            // Initialisieren von Sortable.js für jede Dropzone
            dropzones.forEach(zone => {
                new Sortable(zone.querySelector('.dropzone-content'), {
                    group: {
                        name: 'shared',
                        pull: false,
                        put: true
                    },
                    animation: 150,
                    ghostClass: 'ghost',
                    onAdd: function (evt) {
                        const draggedElement = evt.item;
                        const key = draggedElement.getAttribute('data-key');
                        const correctKey = zone.getAttribute('data-key');

                        if (key === correctKey) {
                            // Überprüfen, ob die Dropzone bereits gefüllt ist
                            if (zone.classList.contains('filled')) {
                                handleWrong();
                                // Rückgängig machen der Aktion
                                evt.from.insertBefore(draggedElement, evt.from.children[evt.oldIndex]);
                                return;
                            }

                            // Markieren der Dropzone als gefüllt
                            zone.classList.add('filled');
                            zone.classList.remove('empty');

                            // Kleine Checkmark hinzufügen
                            const checkmarkSmall = document.createElement('span');
                            checkmarkSmall.classList.add('checkmark-small');
                            checkmarkSmall.innerHTML = '✔️';
                            draggedElement.appendChild(checkmarkSmall);
                            checkmarkSmall.style.display = 'inline';

                            // Draggable deaktivieren
                            draggedElement.classList.add('disable-selection');
                            draggedElement.setAttribute('draggable', false);

                            checkCompletion();
                        } else {
                            // Falsche Zuordnung
                            handleWrong();
                            // Rückgängig machen der Aktion
                            evt.from.insertBefore(draggedElement, evt.from.children[evt.oldIndex]);
                        }
                    }
                });
            });

            function checkCompletion() {
                let allFilled = true;
                dropzones.forEach(zone => {
                    if (!zone.classList.contains('filled')) {
                        allFilled = false;
                    }
                });

                if (allFilled) {
                    completeExercise();
                }
            }

            function completeExercise() {
                const endTime = new Date().getTime();
                const seconds = Math.floor((endTime - startTime) / 1000);
                document.body.classList.add('completed');
                checkmarkLarge.style.display = 'block';
                timeTaken.textContent = `Zeit benötigt: ${seconds} Sekunden`;
                resultDiv.style.display = 'block';
                resultDiv.scrollIntoView({ behavior: 'smooth' });
                localStorage.setItem('matchingCompleted', 'true');
                disableExercise();
            }

            function handleWrong() {
                // Vibration API
                if (navigator.vibrate) {
                    navigator.vibrate(200);
                }
                // Shake-Animation hinzufügen
                document.body.classList.add('shake');
                setTimeout(() => {
                    document.body.classList.remove('shake');
                }, 300);
            }

            function disableExercise() {
                // Deaktivieren aller draggable Items
                draggableItems.forEach(item => {
                    item.setAttribute('draggable', false);
                    item.classList.add('disable-selection');
                });
                // Deaktivieren aller dropzones
                dropzones.forEach(zone => {
                    zone.classList.add('disable-selection');
                });
                if (isCompleted) {
                    // Ergebnis anzeigen, wenn die Übung bereits abgeschlossen wurde
                    resultDiv.style.display = 'block';
                    checkmarkLarge.style.display = 'block';
                }
            }

            // Reset-Schaltfläche Funktionalität
            resetButton.addEventListener('click', function() {
                localStorage.removeItem('matchingCompleted');
                location.reload();
            });

            // Shake-Animation via CSS hinzufügen
            const style = document.createElement('style');
            style.innerHTML = `
                @keyframes shake {
                    0% { transform: translateX(0); }
                    25% { transform: translateX(-5px); }
                    50% { transform: translateX(5px); }
                    75% { transform: translateX(-5px); }
                    100% { transform: translateX(0); }
                }
                .shake {
                    animation: shake 0.3s;
                }
                /* Platzhaltertext für leere Dropzones */
                .dropzone-content.empty::before {
                    content: attr(data-placeholder);
                    color: #6c757d;
                }
                .dropzone-content.filled::before {
                    content: "";
                }
            `;
            document.head.appendChild(style);
        });
    </script>
</body>
</html>
